@page "/workout-plan"
@rendermode InteractiveServer

<h3 class="page-title mb-3">Workout Plan</h3>
<p class="text-muted mb-4">
    Build your weekly workout plan or start from a preset template, then customize it.
</p>

<!-- Template selector -->
<div class="d-flex flex-wrap gap-3 align-items-center mb-4">
    <div class="flex-grow-1">
        <label class="form-label fw-semibold">Quick templates</label>
        <select class="form-select" @bind="selectedTemplate">
            <option value="">Select a preset</option>
            @foreach (var key in Templates.Keys)
            {
                <option value="@key">@key</option>
            }
        </select>
        <div class="form-text">
            Loading a template will replace your current plan.
        </div>
    </div>

    <button class="btn btn-outline-primary"
            @onclick="ApplyTemplate"
            disabled="@string.IsNullOrEmpty(selectedTemplate)">
        Load template
    </button>
</div>

<div class="workout-plan-grid">
    <div class="workout-form-card">
        <h5 class="mb-3">Add Exercise</h5>

        <EditForm Model="@currentExercise" OnValidSubmit="@AddExercise">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="mb-3">
                <label class="form-label fw-semibold">Day of Week</label>
                <InputSelect class="form-select" @bind-Value="currentExercise.Day">
                    <option value="">Select a day</option>
                    @foreach (var day in DaysOfWeek)
                    {
                        <option value="@day">@day</option>
                    }
                </InputSelect>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Exercise Name</label>
                <InputText class="form-control"
                           placeholder="e.g. Bench Press"
                           @bind-Value="currentExercise.Name" />
            </div>

            <div class="row">
                <div class="col-6 mb-3">
                    <label class="form-label fw-semibold">Sets</label>
                    <InputNumber class="form-control"
                                 @bind-Value="currentExercise.Sets" />
                </div>
                <div class="col-6 mb-3">
                    <label class="form-label fw-semibold">Reps</label>
                    <InputNumber class="form-control"
                                 @bind-Value="currentExercise.Reps" />
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Muscle Group (optional)</label>
                <InputText class="form-control"
                           placeholder="e.g. Chest, Legs, Back"
                           @bind-Value="currentExercise.MuscleGroup" />
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Notes (optional)</label>
                <InputTextArea class="form-control"
                               rows="2"
                               placeholder="e.g. Use dumbbells, tempo 3-1-1"
                               @bind-Value="currentExercise.Notes" />
            </div>

            <button type="submit" class="btn btn-primary w-100">
                Add to Plan
            </button>
        </EditForm>
    </div>

    <div class="workout-table-card">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Planned Exercises</h5>
            @if (exercises.Any())
            {
                <button class="btn btn-sm btn-outline-danger" @onclick="ClearPlan">
                    Clear Plan
                </button>
            }
        </div>

        @if (!exercises.Any())
        {
            <p class="text-muted mt-3">
                No exercises yet. Add your first one using the form on the left or load a template above.
            </p>
        }
        else
        {
            @foreach (var group in exercises.GroupBy(e => e.Day))
            {
                <h6 class="mt-3 mb-2 text-uppercase text-muted small">@group.Key</h6>
                <div class="table-responsive">
                    <table class="table table-sm align-middle workout-table">
                        <thead>
                            <tr>
                                <th>Exercise</th>
                                <th>Sets</th>
                                <th>Reps</th>
                                <th>Muscle</th>
                                <th>Notes</th>
                                <th style="width: 60px;"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var ex in group)
                            {
                                <tr>
                                    <td>@ex.Name</td>
                                    <td>@ex.Sets</td>
                                    <td>@ex.Reps</td>
                                    <td>@ex.MuscleGroup</td>
                                    <td>@ex.Notes</td>
                                    <td class="text-end">
                                        <button class="btn btn-sm btn-outline-secondary"
                                                @onclick="() => RemoveExercise(ex)">
                                            Remove
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        }
    </div>
</div>

@code {
    private List<WorkoutExercise> exercises = new();
    private WorkoutExercise currentExercise = new();
    private string? selectedTemplate;

    private static readonly string[] DaysOfWeek = new[]
    {
        "Monday", "Tuesday", "Wednesday", "Thursday",
        "Friday", "Saturday", "Sunday"
    };

    // Preset templates
    private Dictionary<string, List<WorkoutExercise>> Templates => new()
    {
        ["Push / Pull / Legs (6x per week)"] = new List<WorkoutExercise>
        {
            new() { Day = "Monday", Name = "Barbell Bench Press", Sets = 4, Reps = 8, MuscleGroup = "Chest", Notes = "Warm-up sets as needed" },
            new() { Day = "Monday", Name = "Barbell Incline Bench Press", Sets = 3, Reps = 8, MuscleGroup = "Chest", Notes = "Incline sub 45 degrees" },
            new() { Day = "Monday", Name = "Machine Chest Flys", Sets = 3, Reps = 12, MuscleGroup = "Chest", Notes = "Focus on stretch" },
            new WorkoutExercise() { Day = "Monday", Name = "Dumbell Shoulder Press", Sets = 3, Reps = 10, MuscleGroup = "Shoulders", Notes = "Seated or standing" },
            new WorkoutExercise() { Day = "Monday", Name = "Dumbell Lateral Raises", Sets = 3, Reps = 12, MuscleGroup = "Shoulders", Notes = "Focus on form" },
            new WorkoutExercise() { Day = "Monday", Name = "Rope Pull Downs", Sets = 3, Reps = 12, MuscleGroup = "Triceps", Notes = "Use assisted machine if needed" },
            new WorkoutExercise() { Day = "Monday", Name = "Cable Pushdowns", Sets = 3, Reps = 12, MuscleGroup = "Triceps", Notes = "Focus on contraction" },
            new() { Day = "Monday", Name = "Tricep Dips", Sets = 3, Reps = 12, MuscleGroup = "Triceps", Notes = "Bodyweight or weighted" },
            

            new() { Day = "Tuesday", Name = "Pull-ups", Sets = 4, Reps = 6, MuscleGroup = "Back", Notes = "Use assisted machine if needed" },
            new() { Day = "Tuesday", Name = "Lateral Pulldown", Sets = 3, Reps = 12, MuscleGroup = "Back", Notes = "Focus on contraction" },
            new() { Day = "Tuesday", Name = "Back Row", Sets = 3, Reps = 12, MuscleGroup = "Biceps" , Notes = "Any row variation (cable, machine, dumbbell, etc.)"},
            new() { Day = "Tuesday", Name = "Rope Face Pulls/T-Bar Row", Sets = 4, Reps = 8, MuscleGroup = "Back", Notes = "Focus on form" },
            new() { Day = "Tuesday", Name = "Bicep Curls", Sets = 3, Reps = 12, MuscleGroup = "Biceps", Notes = "Squeeze to feel contraction" },
            new() { Day = "Tuesday", Name = "Hammer Curls", Sets = 3, Reps = 12, MuscleGroup = "Biceps", Notes = "Go slow going down after rep" },
            new() { Day = "Tuesday", Name = "Preacher Curls", Sets = 3, Reps = 12, MuscleGroup = "Biceps", Notes = "Can do a dropset or burnout" },

            new() { Day = "Wednesday", Name = "Back Squat", Sets = 4, Reps = 8, MuscleGroup = "Quadriceps, Glutes", Notes = "Warm-up sets as needed" },
            new() { Day = "Wednesday", Name = "Deadlift", Sets = 3, Reps = 10, MuscleGroup = "Hamstrings", Notes = "Maintain a neutral spine" },
            new() { Day = "Wednesday", Name = "Quad Extension", Sets = 3, Reps = 12, MuscleGroup = "Quadriceps", Notes = "Isolate legs for maximum contraction" },
            new() { Day = "Wednesday", Name = "Hip Abductor Machine", Sets = 4, Reps = 15, MuscleGroup = "Glutes", Notes = "Focus on form" },
            new() { Day = "Wednesday", Name = "Calf Raises", Sets = 4, Reps = 15, MuscleGroup = "Calves", Notes = "Pause at the top" },

            new() { Day = "Thursday", Name = "Dumbbell Bench Press", Sets = 4, Reps = 8, MuscleGroup = "Chest", Notes = "Warm-up sets as needed" },
            new() { Day = "Thursday", Name = "Dumbell Incline Bench Press", Sets = 3, Reps = 8, MuscleGroup = "Chest", Notes = "Incline sub 45 degrees" },
            new() { Day = "Thursday", Name = "Cable Chest Flys", Sets = 3, Reps = 12, MuscleGroup = "Chest", Notes = "Squeeze when your hands meet" },
            new() { Day = "Thursday", Name = "Barbell/Smith Machine Shoulder Press", Sets = 3, Reps = 10, MuscleGroup = "Shoulders", Notes = "Keep core tight" },
            new() { Day = "Thursday", Name = "Dumbell Lateral Raises", Sets = 3, Reps = 12, MuscleGroup = "Shoulders", Notes = "Focus on form rather than weight" },
            new() { Day = "Thursday", Name = "Skull Crushers", Sets = 3, Reps = 12, MuscleGroup = "Triceps", Notes = "Control the weight" },
            new() { Day = "Thursday", Name = "Overhead Tricep Extension", Sets = 3, Reps = 12, MuscleGroup = "Triceps", Notes = "Keep elbows close to head" },
            new() { Day = "Thursday", Name = "Tricep Dips", Sets = 3, Reps = 12, MuscleGroup = "Triceps", Notes = "Bodyweight or weighted" },

            new() { Day = "Friday", Name = "Pull-ups", Sets = 4, Reps = 6, MuscleGroup = "Back", Notes = "Use assisted machine if needed" },
            new() { Day = "Friday", Name = "Lateral Pulldown", Sets = 3, Reps = 12, MuscleGroup = "Back", Notes = "Bring bar to upper chest" },
            new() { Day = "Friday", Name = "Back Row", Sets = 3, Reps = 12, MuscleGroup = "Biceps" , Notes = "Any row variation (cable, machine, dumbbell, etc.)"},
            new() { Day = "Friday", Name = "Rope Face Pulls/T-Bar Row", Sets = 4, Reps = 8, MuscleGroup = "Back", Notes = "Make sure to feel contraction in upper back" },
            new() { Day = "Friday", Name = "Bicep Curls", Sets = 3, Reps = 12, MuscleGroup = "Biceps", Notes = "Slow and controlled" },
            new() { Day = "Friday", Name = "Cable Forearm Curls", Sets = 3, Reps = 12, MuscleGroup = "Biceps", Notes = "Focus on form" },
            new() { Day = "Friday", Name = "Machine Preacher Curls", Sets = 3, Reps = 12, MuscleGroup = "Biceps", Notes = "Can use individual arms or both. Burnout/dropset" },


            new() { Day = "Saturday", Name = "Bulgarian Split Squat", Sets = 4, Reps = 8, MuscleGroup = "Quadriceps", Notes = "Per leg" },
            new() { Day = "Saturday", Name = "RDLs", Sets = 3, Reps = 10, MuscleGroup = "Hamstrings", Notes = "Keep back straight" },
            new() { Day = "Saturday", Name = "Quad Extension", Sets = 3, Reps = 12, MuscleGroup = "Quadriceps", Notes = "Isolate legs for maximum contraction" },
            new() { Day = "Saturday", Name = "Machine Hamstring Curls", Sets = 3, Reps = 12, MuscleGroup = "Hamstrings", Notes = "Control the weight" },
            new() { Day = "Saturday", Name = "Hip Abductor Machine", Sets = 4, Reps = 15, MuscleGroup = "Glutes/Hips" },
            new() { Day = "Saturday", Name = "Calf Raises", Sets = 4, Reps = 15, MuscleGroup = "Calves", Notes = "Pause at the top" },
        },

        ["Full Body (3x per week)"] = new List<WorkoutExercise>
        {
            new() { Day = "Monday", Name = "Back Squat", Sets = 3, Reps = 10, MuscleGroup = "Quadriceps/Glutes", Notes = "Warm-up sets as needed" },
            new() { Day = "Monday", Name = "Incline Dumbell Bench Press", Sets = 4, Reps = 8, MuscleGroup = "Chest" },
            new() { Day = "Monday", Name = "Barbell Row", Sets = 3, Reps = 12, MuscleGroup = "Back", Notes = "Underhand grip" },
            new() { Day = "Monday", Name = "Quad Extensions", Sets = 3, Reps = 12, MuscleGroup = "Quadriceps" },
            new() { Day = "Monday", Name = "Dumbbell Bicep Curls", Sets = 3, Reps = 12, MuscleGroup = "Biceps", Notes = "Alternating" },
            new() { Day = "Monday", Name = "Tricep Dips", Sets = 3, Reps = 12, MuscleGroup = "Triceps" },

            new() { Day = "Wednesday", Name = "Dumbell Rows", Sets = 3, Reps = 12, MuscleGroup = "Back" },
            new() { Day = "Wednesday", Name = "Arnold Press", Sets = 3, Reps = 10, MuscleGroup = "Shoulders", Notes = "Use moderate weight for form" },
            new() { Day = "Wednesday", Name = "Bulgarian Split Squat", Sets = 3, Reps = 10, MuscleGroup = "Quadriceps/Glutes", Notes = "Per leg" },
            new() { Day = "Wednesday", Name = "RDLs", Sets = 3, Reps = 10, MuscleGroup = "Hamstrings" },
            new() { Day = "Wednesday", Name = "Cable Tricep Pushdowns", Sets = 3, Reps = 12, MuscleGroup = "Triceps" },
            new() { Day = "Wednesday", Name = "Cable Bicep Curls", Sets = 3, Reps = 12, MuscleGroup = "Triceps", Notes = "Using curly bar attachment" },

            new() { Day = "Friday", Name = "Deadlift", Sets = 3, Reps = 8, MuscleGroup = "Posterior Chain" },
            new() { Day = "Friday", Name = "Flat Barbell Bench Press", Sets = 4, Reps = 8, MuscleGroup = "Chest" },
            new() { Day = "Friday", Name = "Seated Row", Sets = 3, Reps = 12, MuscleGroup = "Back" },
            new() { Day = "Friday", Name = "Leg Press", Sets = 3, Reps = 10, MuscleGroup = "Quadriceps/Glutes" },
            new WorkoutExercise() { Day = "Friday", Name = "Hammer Curls", Sets = 3, Reps = 12, MuscleGroup = "Biceps", Notes = "Use dumbells" },
            new WorkoutExercise() { Day = "Friday", Name = "Overhead Tricep Extension", Sets = 3, Reps = 12, MuscleGroup = "Triceps" },
        },

        ["Upper / Lower (4-day)"] = new List<WorkoutExercise>
        {
            new() { Day = "Monday", Name = "Bench Press", Sets = 4, Reps = 6, MuscleGroup = "Chest", Notes = "Warm-up sets as needed" },
            new() { Day = "Monday", Name = "Pull-ups", Sets = 4, Reps = 6, MuscleGroup = "Back", Notes = "Use assisted machine if needed" },
            new() { Day = "Monday", Name = "Lateral Raises", Sets = 3, Reps = 12, MuscleGroup = "Shoulders", Notes = "Light weight for form" },
            new() { Day = "Monday", Name = "Dumbbell Bicep Curls", Sets = 3, Reps = 12, MuscleGroup = "Biceps"},
            new() { Day = "Monday", Name = "Tricep Dips", Sets = 3, Reps = 12, MuscleGroup = "Triceps", Notes = "Use assisted machine if needed" },

            new() { Day = "Tuesday", Name = "Back Squat", Sets = 4, Reps = 8, MuscleGroup = "Legs", Notes = "Warm-up sets as needed" },
            new() { Day = "Tuesday", Name = "Leg Press", Sets = 3, Reps = 10, MuscleGroup = "Legs", Notes = "Feet shoulder-width apart" },
            new() { Day = "Tuesday", Name = "Quad Extensions", Sets = 3, Reps = 12, MuscleGroup = "Quadriceps", Notes = "One leg at a time to increase difficulty"},
            new() { Day = "Tuesday", Name = "Hamstring Curls", Sets = 3, Reps = 12, MuscleGroup = "Hamstrings", Notes = "Slow and controlled" },

            new() { Day = "Thursday", Name = "Incline Bench", Sets = 4, Reps = 8, MuscleGroup = "Chest", Notes = "Incline sub 45 degrees"},
            new() { Day = "Thursday", Name = "Barbell Row", Sets = 4, Reps = 8, MuscleGroup = "Back", Notes = "Underhand grip" },
            new() { Day = "Thursday", Name = "Face Pulls", Sets = 3, Reps = 15, MuscleGroup = "Rear Delts", Notes = "Use rope attachment" },
            new() { Day = "Thursday", Name = "Dumbbell Shrugs", Sets = 3, Reps = 12, MuscleGroup = "Traps", Notes = "Focus on squeezing at the top" },

            new() { Day = "Friday", Name = "Deadlift", Sets = 3, Reps = 5, MuscleGroup = "Posterior Chain", Notes = "Focus on form" },
            new() { Day = "Friday", Name = "Walking Lunges", Sets = 3, Reps = 12, MuscleGroup = "Legs", Notes = "Per leg" },
            new() { Day = "Friday", Name = "Calf Raises", Sets = 4, Reps = 15, MuscleGroup = "Calves", Notes = "Pause at top" },
            new() { Day = "Friday", Name = "Plank", Sets = 3, Reps = 30, MuscleGroup = "Core", Notes = "Hold for 30 seconds" }
        }
    };

    private void ApplyTemplate()
    {
        if (string.IsNullOrEmpty(selectedTemplate))
            return;

        if (!Templates.TryGetValue(selectedTemplate, out var template))
            return;

        // clone list so editing doesn't mutate template definitions
        exercises = template.Select(e => new WorkoutExercise
        {
            Day = e.Day,
            Name = e.Name,
            Sets = e.Sets,
            Reps = e.Reps,
            MuscleGroup = e.MuscleGroup,
            Notes = e.Notes
        }).ToList();

        // reset current form
        currentExercise = new WorkoutExercise();
    }

    private void AddExercise()
    {
        if (string.IsNullOrWhiteSpace(currentExercise.Day) ||
            string.IsNullOrWhiteSpace(currentExercise.Name))
        {
            return;
        }

        exercises.Add(new WorkoutExercise
        {
            Day = currentExercise.Day,
            Name = currentExercise.Name,
            Sets = currentExercise.Sets,
            Reps = currentExercise.Reps,
            MuscleGroup = currentExercise.MuscleGroup,
            Notes = currentExercise.Notes
        });

        currentExercise = new WorkoutExercise();
    }

    private void RemoveExercise(WorkoutExercise ex)
    {
        exercises.Remove(ex);
    }

    private void ClearPlan()
    {
        exercises.Clear();
        currentExercise = new WorkoutExercise();
    }

    public class WorkoutExercise
    {
        public string Day { get; set; } = "";
        public string Name { get; set; } = "";
        public int Sets { get; set; } = 3;
        public int Reps { get; set; } = 8;
        public string MuscleGroup { get; set; } = "";
        public string Notes { get; set; } = "";
    }
}
